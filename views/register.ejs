<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ“ Registro - NexaWeb2</title>
  <link rel="stylesheet" href="/register.css" />
  <!-- Google reCAPTCHA v2 -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <div class="register-container">
    <h1 class="register-title">ğŸ“ Crear Cuenta</h1>
    <div class="register-subtitle">Completa los campos para crear tu cuenta</div>

    <% if (error) { %>
      <p class="error"><%= error %></p>
    <% } %>

    <% if (success) { %>
      <p class="success"><%= success %></p>
    <% } %>

    <form action="/register" method="POST">
      <div class="input-group">
        <label for="nombres_y_apellidos">Nombres y Apellidos</label>
        <input type="text" id="nombres_y_apellidos" name="nombres_y_apellidos" placeholder="Nombres y Apellidos" required />
      </div>

      <div class="input-group">
        <label for="identificacion">NÃºmero de IdentificaciÃ³n</label>
        <input type="text" id="identificacion" name="identificacion" placeholder="NÃºmero de IdentificaciÃ³n" required />
      </div>

      <div class="input-group">
        <label for="correo_electronico">Correo ElectrÃ³nico (opcional)</label>
        <input type="email" id="correo_electronico" name="correo_electronico" placeholder="Correo ElectrÃ³nico" />
      </div>

      <div class="input-group">
        <label for="contrasena">ContraseÃ±a</label>
        <input type="password" id="contrasena" name="contrasena" placeholder="ContraseÃ±a" required minlength="6" />
      </div>

      <div class="input-group">
        <label for="confirmar_contrasena">Confirmar ContraseÃ±a</label>
        <input type="password" id="confirmar_contrasena" name="confirmar_contrasena" placeholder="Confirmar ContraseÃ±a" required />
      </div>

      <div class="input-group">
        <label for="rol">Tipo de Usuario</label>
        <select name="rol" id="rol" required>
          <option value="normal">ğŸ‘¤ Usuario Normal</option>
          <option value="admin">ğŸ¯ Administrador</option>
          <option value="superadmin">ğŸ‘‘ Super Administrador</option>
        </select>
      </div>

      <!-- reCAPTCHA v2 Widget -->
      <div class="input-group captcha-container">
        <div class="g-recaptcha" 
             data-sitekey="<%= process.env.RECAPTCHA_SITE_KEY %>"
             data-theme="light"
             data-size="normal">
        </div>
      </div>

      <button type="submit" class="register-btn">ğŸ“ Registrarse</button>
    </form>

    <p style="margin-top: 20px; text-align: center;">
      Â¿Ya tienes cuenta? <a href="/login">ğŸ” Iniciar SesiÃ³n</a>
    </p>
  </div>

  <!-- Script de debug para reCAPTCHA -->
  <script>
    // Debug: verificar que reCAPTCHA se carga
    document.addEventListener('DOMContentLoaded', function() {
      console.log('PÃ¡gina cargada');
      console.log('Site Key:', '<%= process.env.RECAPTCHA_SITE_KEY %>');
      
      // Verificar si grecaptcha estÃ¡ disponible
      setTimeout(function() {
        if (typeof grecaptcha !== 'undefined') {
          console.log('âœ… reCAPTCHA cargado correctamente');
        } else {
          console.error('âŒ reCAPTCHA no se cargÃ³');
        }
      }, 2000);
    });

    // Debug: verificar el token antes de enviar
    document.querySelector('form').addEventListener('submit', function(e) {
      const recaptchaResponse = grecaptcha.getResponse();
      console.log('Token reCAPTCHA:', recaptchaResponse);
      
      if (!recaptchaResponse) {
        e.preventDefault();
        alert('Por favor, completa la verificaciÃ³n reCAPTCHA');
        return false;
      }
    });
  </script>
</body>
</html>